â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                â•‘
â•‘    Fail2Ban + nftables v0.33 - Production Bundle               â•‘
â•‘      One-Click IPv4 + IPv6 + Docker-Block Security System      â•‘
â•‘                 (Twelve Jails, Twenty-Four Sets)               â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERSION: 0.33
WRAPPER VERSION: 0.33
RELEASE DATE: December 29, 2025
UPGRADE FROM: v0.19â€“v0.31 (auto-detect)
LICENSE: MIT


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
KEY CHANGES IN v0.33
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”Ÿâ•â TWELVE JAILS & TWENTY-FOUR SETS:
  âœ… New 12th jail: nginx-php-errors
     â€¢ Detects PHP fatÃ¡lne chyby a HTTP 5xx anomÃ¡lne patterny
     â€¢ Filter: f2b-nginx-php-errors.conf
     â€¢ Local tuning: nginx-php-errors.local
     â€¢ Sets: f2b-nginx-php-errors (IPv4) + f2b-nginx-php-errors-v6 (IPv6)
  âœ… Infrastructure counts (final):
     â€¢ 12 IPv4 sets + 12 IPv6 sets (fail2ban-filter table)
     â€¢ 24 INPUT rules (12 IPv4 + 12 IPv6)
     â€¢ 8 FORWARD rules (4 IPv4 + 4 IPv6, including PHP jail in docker-block)
     â€¢ 12 Fail2Ban jails + 12 detection filters

ğŸ“‹ COMPLETE JAILS LIST (12):
  1. sshd â€“ SSH brute-force (multi-mode)
  2. sshd-slowattack â€“ Slow SSH attack patterns
  3. f2b-exploit-critical â€“ Critical exploit scanners
  4. f2b-dos-high â€“ DoS/DDoS attack detection
  5. f2b-web-medium â€“ SQL injection, path traversal
  6. nginx-recon-optimized â€“ Nginx reconnaissance
  7. f2b-fuzzing-payloads â€“ Fuzzing detection
  8. f2b-botnet-signatures â€“ Botnet/scanner signatures
  9. f2b-anomaly-detection â€“ Anomaly patterns (HTTP + access)
  10. nginx-php-errors â€“ PHP errors + 5xx anomalies â­ NEW
  11. manualblock â€“ Manual IP banning
  12. recidive â€“ Repeat offenders (30-day ban)

ğŸ“Š WRAPPER v0.33:
  âœ… Extended JAILS array (12 jails)
  âœ… Extended SETMAP (PHP jail IPv4 + IPv6 sets)
  âœ… All monitoring, sync, and report commands for 12 jails
  âœ… Enhanced verify with PHP jail validation
  âœ… Lock mechanism, IPv6 validation, jq helpers
  âœ… 50+ management functions

ğŸš€ OKAMÅ½ITÃ DOCKER-BLOCK BAN (v0.31 retained):
  âœ… New Fail2Ban action: docker-sync-hook.conf
     â€¢ Calls f2b-docker-hook.sh on ban/unban
     â€¢ Parameters: ban|unban <ip> <jail> <bantime>
  âœ… f2b-docker-hook.sh:
     â€¢ Adds/removes IP to/from nftables sets:
       - docker-banned-ipv4
       - docker-banned-ipv6
     â€¢ Uses table inet docker-block
     â€¢ Sets element timeout equal to Fail2Ban bantime
  âœ… Result:
     â€¢ Docker traffic is blocked immediately when Fail2Ban bans an IP
     â€¢ Cron is used only for validation/repair, not for initial ban

ğŸ‹ DOCKER-BLOCK v0.4 + VALIDATE MODE:
  âœ… docker-block table (inet docker-block):
     â€¢ docker-blocked-ports (service ports)
     â€¢ docker-banned-ipv4 / docker-banned-ipv6
  âœ… Validate cron (instead of primary banning):
     â€¢ Root cron runs every minute:
       - f2b docker sync validate
     â€¢ Uses flock locking
     â€¢ Logs to /var/log/f2b-docker-sync.log
  âœ… Purpose:
     â€¢ Validate and repair docker-block sets according to Fail2Ban
     â€¢ Primary ban path is now the immediate hook (f2b-docker-hook.sh)

ğŸ§¹ SAFE PRE-CLEANUP AND AUTO-SYNC (UPDATED FOR v0.33):
  âœ… 00-pre-cleanup-v033.sh:
     â€¢ Backups: nftables ruleset + fail2ban configs
     â€¢ Cleans legacy systemd units, cron entries and aliases
  âœ… 05-install-auto-sync-v033.sh:
     â€¢ Performs initial full Fail2Ban â†’ nftables sync (IPv4 + IPv6)
     â€¢ Compares IP counts and prints a summary for auditing


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PACKAGE CONTENTS (v0.33)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ ROOT:
  âœ… INSTALL-ALL-v033.sh              Universal installer (one-click v0.33)
  âœ… README.md                        Main usage guide (updated for v0.33)
  âœ… CHANGELOG.md                     Version history (includes v0.33)
  âœ… MIGRATION-GUIDE.md               Upgrade guide (v0.19 â†’ v0.33)
  âœ… PACKAGE-INFO.txt                 This file
  âœ… LICENSE                          MIT License

ğŸ“‚ scripts/ (core logic):
  âœ… 00-pre-cleanup-v033.sh           Pre-install cleanup, backup, legacy removal
  âœ… 01-install-nftables-v033.sh      nftables infrastructure (12+12 sets, 24+8 rules)
  âœ… 02-install-jails-v033.sh         Jails + filters + actions installer (12 jails)
  âœ… 02-verify-jails-v033.sh          Post-install verifier (expects 12 jails, 24 sets)
  âœ… 03-install-docker-block-v033.sh  Docker port + IP blocking (inet docker-block, 8 FORWARD)
  âœ… 04-install-wrapper-v033.sh       F2B wrapper installer (v0.33 â†’ /usr/local/bin/f2b)
  âœ… 05-install-auto-sync-v033.sh     Initial auto-sync (Fail2Ban â†’ nftables)
  âœ… 06-install-aliases-v033.sh       Minimal f2b-* aliases (optional)
  âœ… 07-setup-docker-sync-cron-v033.sh Docker-block validate cron (every minute)
  âœ… f2b-wrapper-v033.sh              Main wrapper (50+ functions, version 0.33)
  âœ… f2b-docker-hook.sh               Immediate docker-block ban/unban hook

ğŸ“‚ filters/ (12 detection filters):
  âœ… sshd.conf                        SSH brute-force (multi-mode, slowattack)
  âœ… f2b-exploit-critical.conf        Critical exploit scanners
  âœ… f2b-dos-high.conf                DoS/DDoS patterns
  âœ… f2b-web-medium.conf              Web attacks (SQLi, path traversal, etc.)
  âœ… nginx-recon-optimized.conf       Nginx reconnaissance
  âœ… f2b-fuzzing-payloads.conf        Fuzzing payloads
  âœ… f2b-botnet-signatures.conf       Botnet/scanner signatures
  âœ… f2b-anomaly-detection.conf       Anomaly patterns
  âœ… nginx-php-errors.conf            PHP errors + 5xx anomalies â­ NEW
  âœ… manualblock.conf                 Manual IP banning
  âœ… recidive.conf                    Recidive jail (30d ban)
  âœ… jail.local                       12 jails (correct banaction mapping + docker hook)

ğŸ“‚ config/ (custom config):
  âœ… nginx-recon-optimized.local      Filter extension (ignoreregex, tuning)
  âœ… f2b-anomaly-detection.local      Filter extension (ignoreregex, tuning)
  âœ… nginx-php-errors.local           Filter extension (PHP error patterns) â­ NEW

ğŸ“‚ action.d/ (nftables and docker actions):
  â­ nftables-common.local            Table override (inet fail2ban-filter) [CRITICAL]
  â­ nftables-multiport.conf          Generic 7d action (IPv4+IPv6)
  â­ nftables-recidive.conf           30d recidive action (FORWARD + INPUT, IPv4 only)
  â­ nftables.conf.local              Common nftables overrides (inet, f2b-input)
  â­ docker-sync-hook.conf            Fail2Ban action calling f2b-docker-hook.sh


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UPGRADE PATHS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FROM v0.31 (Most Common):
  âœ… Run:
     â€¢ sudo bash INSTALL-ALL-v033.sh
  âœ… Installer will:
     â€¢ Preserve all existing bans (Fail2Ban + nftables)
     â€¢ Add 12th jail (nginx-php-errors) with 2 new nftables sets
     â€¢ Update wrapper from v0.32 to v0.33
     â€¢ Rebuild docker-block with 8 FORWARD rules (was 6)
     â€¢ Verify: 12 jails, 24 sets, 24 INPUT, 8 FORWARD

FROM v0.30:
  âœ… Run:
     â€¢ sudo bash INSTALL-ALL-v033.sh
  âœ… Installer will:
     â€¢ Detect v0.30 installation
     â€¢ Preserve all 11 existing jails + bans
     â€¢ Add 12th jail (nginx-php-errors)
     â€¢ Update wrapper to v0.33
     â€¢ Final state: 12 jails, 24 sets

FROM v0.22 / v0.24:
  âœ… Recommended:
     â€¢ Direct run: sudo bash INSTALL-ALL-v033.sh
     â€¢ Auto-detection will handle the upgrade
  âœ… Installer will:
     â€¢ Preserve v0.22/v0.24 nftables structure (11+11 sets)
     â€¢ Add 12th jail and corresponding sets
     â€¢ Preserve all bans (IPv4 + IPv6)
     â€¢ Update wrapper to v0.33

FROM v0.19 / v0.20:
  âœ… Supported:
     â€¢ Direct run: sudo bash INSTALL-ALL-v033.sh
     â€¢ Auto-detect will upgrade from legacy v0.19 IPv4-only structure
  âœ… Installer will:
     â€¢ Preserve existing bans
     â€¢ Add IPv6 infrastructure (if not present)
     â€¢ Add 12 jails with 12 filters
     â€¢ Update wrapper to v0.33

CLEAN INSTALL (new server):
  âœ… INSTALL-ALL-v033.sh:
     â€¢ Creates full nftables + Fail2Ban + Docker-block + sync setup
     â€¢ Installs 12 jails + 12 filters
     â€¢ Installs wrapper v0.33 and auto-sync
     â€¢ Configures docker-block validate cron
     â€¢ Adds minimal wrapper aliases (optional)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QUICK VERIFY AFTER INSTALL (v0.33)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1) Check nftables structure
sudo nft list table inet fail2ban-filter
sudo nft list table inet docker-block

2) Check jails (should be 12)
sudo fail2ban-client status
sudo fail2ban-client status nginx-php-errors

3) Wrapper & sync
sudo f2b status
sudo f2b sync check
sudo f2b docker info
sudo f2b docker dashboard

4) Optional deep verify
sudo bash 02-verify-jails-v033.sh

If all checks pass and counts match (12 sets v4, 12 sets v6, 24 INPUT, 8 FORWARD, 12 jails) and docker-block bans are applied immediately on ban events, your system is fully protected with the v0.33 bundle.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERSION COMPARISON TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

| Feature               | v0.30 | v0.31 | v0.33 |
|----------------------|-------|-------|-------|
| IPv4 Support         | âœ…    | âœ…    | âœ…    |
| IPv6 Support         | âœ…    | âœ…    | âœ…    |
| nftables Sets        | 22    | 22    | 24    |
| INPUT Rules          | 22    | 22    | 24    |
| FORWARD Rules        | 6     | 6     | 8     |
| Fail2Ban Jails       | 11    | 11    | 12    |
| Detection Filters    | 11    | 11    | 12    |
| F2B Wrapper Functions| 50+   | 50+   | 50+   |
| Docker Immediate Ban | âŒ    | âœ…    | âœ…    |
| Docker Validate Cron | âœ…    | âœ…    | âœ…    |
| One-Click Installer  | âœ…    | âœ…    | âœ…    |
| Auto-Upgrade Detect  | âœ…    | âœ…    | âœ…    |


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
REQUIREMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Minimum:
  â€¢ Linux kernel 4.8+ (nftables support)
  â€¢ Fail2Ban 0.10+ (Python 3.5+)
  â€¢ nftables 0.9+
  â€¢ Bash 4.0+

Recommended:
  â€¢ Ubuntu 20.04 LTS+ / Debian 11+
  â€¢ Fail2Ban 0.11+ with Python 3.7+
  â€¢ nftables 1.0+ (latest)
  â€¢ At least 512MB free disk space for logs

Docker (optional):
  â€¢ Docker 19.03+
  â€¢ docker-compose 1.25+ (for docker-block management)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PERFORMANCE & SECURITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Performance:
  â€¢ nftables rules: <100Âµs per packet match (kernel-level)
  â€¢ Fail2Ban scan cycle: 1 minute (default)
  â€¢ Docker-block immediate ban: <1ms hook latency
  â€¢ Sync operations: <5s for full nftables/F2B audit
  â€¢ Minimal memory footprint: ~15-20MB Fail2Ban + ~5MB nftables

Security:
  â€¢ IPv4 + IPv6 dual-stack protection
  â€¢ Persistent ruleset (survives reboot)
  â€¢ Atomic nftables transactions (no partial states)
  â€¢ Lock mechanism prevents concurrent wrapper operations
  â€¢ Docker pre-NAT blocking (prevents Docker bypass)
  â€¢ 30-day recidive jail for persistent offenders
  â€¢ 50+ wrapper functions with attack analysis


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Common Issues:

1) Installer fails on pre-cleanup
   â†’ Check: sudo bash INSTALL-ALL-v033.sh --cleanup-only
   â†’ Check backup: ls /root/f2b-backup-v033*/
   â†’ Verify permissions: sudo systemctl status nftables

2) Jails not starting
   â†’ Check: sudo tail -f /var/log/fail2ban.log
   â†’ Verify: sudo fail2ban-client status
   â†’ Test filter: sudo fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf

3) nftables rules missing
   â†’ Check: sudo nft list table inet fail2ban-filter
   â†’ Reapply: sudo bash 01-install-nftables-v033.sh
   â†’ Sync: sudo f2b sync force

4) Docker-block not blocking
   â†’ Check: sudo nft list table inet docker-block
   â†’ Verify: sudo f2b docker info
   â†’ Repair: sudo f2b docker sync validate
   â†’ Cron: crontab -l | grep f2b

5) Wrapper not found
   â†’ Check: which f2b
   â†’ Reinstall: sudo bash 04-install-wrapper-v033.sh
   â†’ Verify: sudo f2b version --short


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LICENSE & AUTHOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

License: MIT (see LICENSE file)
Author: Peter Bakic
Contact: Self-hosted infrastructure & security specialist

For issues, features, or security concerns:
  â€¢ GitHub Issues: Report bugs and feature requests
  â€¢ Security: Please report security issues responsibly


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Production Ready: âœ… YES
Last Tested: December 29, 2025
Supported Until: v0.34+ release (ongoing updates)

This is the v0.33 stable production release with 12 jails, 24 nftables sets,
and full IPv4/IPv6 dual-stack Docker protection.


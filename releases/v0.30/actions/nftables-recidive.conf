# Fail2Ban Hybrid Manager v0.30
# Fail2Ban Action: nftables-recidive.conf
# Date: 2025-12-19
# Managed by: INSTALL-ALL-v030 bundle

# Fail2Ban nftables action for recidive jail - 30 days ban
# IPv4 only (99.97% of attacks)

[INCLUDES]
after = nftables-common.local

[Definition]

# IPv4 set creation (30d timeout)
actionstart = nft add set inet <table> f2b-recidive '{ type ipv4_addr; flags interval,timeout; auto-merge; timeout 30d; }'
              nft add rule inet <table> <chain> ip saddr @f2b-recidive drop

actionflush = nft flush set inet <table> f2b-recidive

actionstop = nft delete set inet <table> f2b-recidive 2>/dev/null || true

# IPv4 ban (30d timeout - 2592000s)
actionban = nft add element inet <table> f2b-recidive { <ip> timeout 2592000s }

# Unban
actionunban = nft delete element inet <table> f2b-recidive { <ip> }

actioncheck = nft list set inet <table> f2b-recidive

[Init]
# Inherits from nftables-common.local:
# - table = fail2ban-filter
# - chain = f2b-input
